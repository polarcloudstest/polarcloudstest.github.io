<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="prefer-datetime-locale" content="en-gb"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="vSphere Compliance with vRealize Operations and Tagging" /><meta property="og:locale" content="en" /><meta name="description" content="Creating Continual Regulatory Compliance" /><meta property="og:description" content="Creating Continual Regulatory Compliance" /><link rel="canonical" href="/posts/vsphere-compliance-with-vro/" /><meta property="og:url" content="/posts/vsphere-compliance-with-vro/" /><meta property="og:site_name" content="PolarClouds" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-28T01:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="vSphere Compliance with vRealize Operations and Tagging" /><meta name="twitter:site" content="@chall32" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-28T01:00:00+01:00","datePublished":"2022-06-28T01:00:00+01:00","description":"Creating Continual Regulatory Compliance","headline":"vSphere Compliance with vRealize Operations and Tagging","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/vsphere-compliance-with-vro/"},"url":"/posts/vsphere-compliance-with-vro/"}</script><title>vSphere Compliance with vRealize Operations and Tagging | PolarClouds</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="PolarClouds"><meta name="application-name" content="PolarClouds"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://polarclouds.co.uk/images/pages/ch200x200.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">PolarClouds</a></div><div class="site-subtitle font-italic">The personal blog of me, Chris Hall</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/chall32" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/chall32" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','domain.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>vSphere Compliance with vRealize Operations and Tagging</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>vSphere Compliance with vRealize Operations and Tagging</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1656374400" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 28, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/chall32">Chris Hall</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2467 words"> <em>13 min</em> read</span></div></div></div><div class="post-content"><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3C/svg%3E" data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-01.png" alt="vRO CIS and DISA Logos" width="200" height="200" style="max-width: 200px" class="right" data-proofer-ignore> In these days of anywhere computing, one of the tools in the arsenal of the good guys is system hardening. But what is system hardening?</p><p>System hardening is defined as the practice of reducing a system’s vulnerability by reducing its attack surface. Through a reduced attack surface, there is a lower risk of data breaches, unauthorized access, system hacking, or malware infection.</p><p>Hardening may involve a reduction in attack surface through cutting unnecessary services or processes. Therefore for most environments a level of system hardening is required, but how much system hardening is required? How are systems hardened? Are there any system hardening compliance standards or guides that we could follow? Which standard best fits my scenario?</p><p>As with so may things in life, there are options. How much hardening depends on your risk appetite. <br /><strong>Spoiler Alert</strong>: a list of compliance standards is included later on in this post (/posts[tl,dr])</p><p>For example, two popular hardening benchmarks are CIS and DISA STIG. These are available:</p><ul><li>CIS Benchmarks: <a href="https://downloads.cisecurity.org/" target="_blank">Here</a><li>DISA STIG Benchmarks: <a href="https://public.cyber.mil/stigs/downloads/" target="_blank">Here</a></ul><h2 id="objectives"><span class="mr-2">Objectives</span><a href="#objectives" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Whilst vRealize Operations (vRO) can be integrated into VMware Cloud on AWS, Azure VMware Solution, Google Cloud VMware Engine as well as native Azure and AWS environments, in this post we shall address the hardening of a Software Defined Data Center on premises vSphere environment.</p><p>In so doing, we shall be system hardening the following components that make up a vSphere environment:</p><ul><li>ESXi Hosts<li>vCenter Servers<li>Distributed Switches<li>Distributed Switch Ports<li>vSAN (if deployed)<li>NSX-T (if deployed)<li>Virtual Machine Configurations</ul><p>We will <strong>NOT</strong> be system hardening the guest operating systems running inside the virtual machines. These operating systems have their own system hardening standards / benchmarks so are therefore outside the scope of this article.</p><h2 id="what-is-vrealize-operations"><span class="mr-2">What is vRealize Operations?</span><a href="#what-is-vrealize-operations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>From the VMware <a href="https://www.vmware.com/uk/products/vrealize-operations.html" target="_blank">marketing blurb</a>:<br /> VMware vRealize Operations provides self-driving IT Operations Management across private, hybrid and multi-cloud environments with a unified operations platform that delivers continuous performance, capacity and cost optimization, intelligent remediation and integrated compliance through AI/ML and predictive analytics.</p><p>Chris’ take:<br /> vRO monitors environments for alerts, symptoms and conditions. Compliance standards loaded into vRO are a set of alerts where by an object is not configured to satisfy the condition of the alert will cause the alert to be flagged.</p><h2 id="vsphere-configuration"><span class="mr-2">vSphere Configuration</span><a href="#vsphere-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>As discussed, in this post we shall address the hardening of a Software Defined Data Center on premises vSphere environment.</p><p>We will be using the following lab environment:</p><ul><li>vSphere 7 update 3 - Single vCenter and single ESXi host<li>vRO 8.6.3 - Single VM, extra small</ul><p>No licences have been procured for this environment. All software is in evaluation mode.</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-02.png" alt="vSphere" data-proofer-ignore></p><p>Networking:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-03.png" alt="vSphere Networking" data-proofer-ignore></p><p>Yep, nothing complicated at all. Much, much larger environments are available!</p><h3 id="why-vsphere-tags"><span class="mr-2">Why vSphere Tags?</span><a href="#why-vsphere-tags" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>When it comes to compliance, much as we would like it, occasionally (often) there are objects that at any one particular point in time are not required to be compliant with the system hardening benchmark in use across the environment. For example we may be deploying a an isolated test/dev environment or a quick temporary virtual machine, network port group, whatever. At this point in time these do not need to be compliant. Compliance may/can come later.</p><p>Having these known non-compliant environments being continually flagged in vRO is undesirable and may obscure issues elsewhere with objects that absolutely need to be compliant (think: “was it six or seven VMs and two or three port groups that we don’t need to care about compliance failures on?!?”).</p><p>Therefore, how can we “tune out the cruft” from vRO so that we can concentrate on the rest of the environment that absolutely needs to be compliant?</p><p>Simple:</p><ol><li>Configure compliance monitoring so that ALL objects need to be compliant by default<li>Employ a vSphere tag to mark objects that don’t need to be compliant<li>Manage by exception</ol><h3 id="configure-vsphere-tags"><span class="mr-2">Configure vSphere Tags</span><a href="#configure-vsphere-tags" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s setup our vSphere tags for our compliance exceptions.<br /> From the vSphere Client, select <strong>Menu &gt; Tags &amp; Custom Attributes &gt; Tags</strong> and <strong>Categories</strong>. From here we will create a new tag category named <strong>Compliance</strong>:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-05.png" alt="vSphere Compliance Category" data-proofer-ignore></p><p>Next, we need to create a tag that should be applied to the vSphere objects that should be excluded from compliance. Select <strong>Menu &gt; Tags &amp; Custom Attributes &gt; Tags</strong> and <strong>Tags</strong>:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-06.png" alt="vSphere Compliance Tag" data-proofer-ignore></p><h3 id="apply-vsphere-tags"><span class="mr-2">Apply vSphere Tags</span><a href="#apply-vsphere-tags" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Within my test environment, I want to CIS compliance scan everything <strong>except</strong> the following two VMs:</p><ul><li>WIN-2022 - My Windows 2022 test/dev VM<li>vCLS-386d4abf-c432-4d1f-a4a2-c6355100f4b4 - the vSphere Cluster Services VM (see <a href="https://kb.vmware.com/s/article/80472" target="_blank">here</a> for details)</ul><p>Find the VM Tags dialogue:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-07.png" alt="Tag" data-proofer-ignore></p><p>Apply the tag:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-08.png" alt="Apply Tag" data-proofer-ignore></p><p>Confirm application:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-09.png" alt="Confirm Tag" data-proofer-ignore></p><p>To confirm which objects have the tag applied and which do not, simply search for the tag in the inventory and select <strong>Objects</strong>:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-10.png" alt="List Objects with Tag" data-proofer-ignore></p><p>This list can be then be exported and provided to my security/compliance department as proof of those objects NOT in compliance with the hardening applied across the rest of the environment.</p><h2 id="vrealize-operations-configuration"><span class="mr-2">vRealize Operations Configuration</span><a href="#vrealize-operations-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I won’t cover the deployment of the vRealize Operations appliance here. Should you need further info, see <a href="https://docs.vmware.com/en/vRealize-Operations/8.6/com.vmware.vcom.vapp.doc/GUID-49349FD7-7237-4022-A6A5-1B26D7AFC7DF.html" target="_blank">Deployment of vRealize Operations</a> and the <a href="https://vropssizer.vmware.com/" target="_blank">vRealize Operations Sizing Tool</a>.</p><p>To integrate vRO with vCenter, logon to vRO with the admin account, select <strong>Data Sources &gt; Integrations &gt; Add Account &gt; vCenter</strong> and add your vCenter details.</p><p>Once vCenter has been integrated, you should see the following:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-11.png" alt="vSphere Integration" data-proofer-ignore></p><h3 id="activating-compliance-standard-to-apply-to-vsphere"><span class="mr-2">Activating Compliance Standard to Apply to vSphere</span><a href="#activating-compliance-standard-to-apply-to-vsphere" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Next we need to select a compliance standard baseline to which we require our environment to conform to. From the vRealize Operations console, select <strong>Optimise &gt; Compliance</strong>. As you can see from below, there are several built in Regulatory Standards / Benchmarks available to choose from. These include:</p><ul><li>CIS Security Standards<li>DISA Security Standards<li>FISMA Security Standards<li>HIPAA Compliance<li>ISO Security Standards<li>PCI Security Standards</ul><p>As can be seen below:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-12.png" alt="Regulatory Benchmarks" data-proofer-ignore></p><p>In the following example we will be using the CIS Security Standard to harden our vSphere environment.</p><p>In the CIS Security Standard option box, select <strong>Activate from Repository</strong>, <strong>Activate</strong> and <strong>Yes</strong> to activate the CIS standard. Confirm CIS compliance integration has been installed:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-13.png" alt="CIS Activated" data-proofer-ignore></p><p>Do not activate the standard just yet. We will handle activation later.</p><h3 id="configuring-a-compliance-standard-to-apply-to-vsphere"><span class="mr-2">Configuring a Compliance Standard to Apply to vSphere</span><a href="#configuring-a-compliance-standard-to-apply-to-vsphere" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As discussed above, given that vRO operates via alerting, lets go find our newly downloaded compliance alerts. From the vRO console, select <strong>Configure &gt; Alerts &gt; Alert Definitions</strong> and filter by compliance standard activated (in my case CIS):</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-14.png" alt="CIS Alert Definitions" data-proofer-ignore></p><p>As can be seen in the case of CIS, there are four alerts that have been created.</p><p>Notice that there is no alert configuration for vCenter server. The compliance standard chosen - CIS - does not contain hardening standards for vCenter. Others hardening compliance standards such as STIG certainly do contain <a href="https://www.stigviewer.com/stig/vmware_vsphere_6.7_vcenter/" target="_blank">hardening standards for vCenter</a>.</p><h4 id="esxi-host-is-violating-cis-alert-definition"><span class="mr-2">ESXi Host is Violating CIS Alert Definition</span><a href="#esxi-host-is-violating-cis-alert-definition" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>So that we may always have untouched alert definitions to go back to later should we need to, we will clone the alert definitions to create our own.</p><p>Using the three dots to the right of each of the alert definitions, select clone: <img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-15.png" alt="Clone Alert Definition" data-proofer-ignore></p><p>To make my alert definitions easier to find in the future, I shall suffix my alert definitions with “PolarClouds”:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-16.png" alt="Name Clone Alert Definition" data-proofer-ignore></p><p>Click <strong>Next</strong>. Here we can see the individual tests that constitute the “violating CIS” vRO alert:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-17.png" alt="Name Clone Alert Definition Tests" data-proofer-ignore></p><p>From here, we can remove any unwanted symptoms that we do not want to test for. Typically I remove the following tests:</p><ul><li>Use Active Directory for local user authentication <sup>1</sup><li>Enable vSphere Authentication Proxy when adding hosts to Active Directory <sup>1</sup><li>Enable bidirectional CHAP authentication for iSCSI traffic <sup>2</sup></ul><p><sup>1</sup> <em>Whilst I agree AD integration is something that should be considered for ease of administration, in my experience it is not something regularly implemented. From a 10,000 foot view, I would argue that Active Directory is a larger attack vector than ESXi.</em><br /> <sup>2</sup> <em>I’m not using iSCSI in my lab.</em></p><p>Use the <strong>X</strong> to remove the unwanted symptoms:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-18.png" alt="Remove Test" data-proofer-ignore></p><p>Click <strong>Next &gt; Next</strong>, ensure no policies are selected to be enabled (again we will do this later) and finally <strong>Create</strong> to create the new PolarClouds ESXi Host is violating CIS policy.</p><h4 id="virtual-machine-is-violating-cis-alert-definition"><span class="mr-2">Virtual Machine is Violating CIS Alert Definition</span><a href="#virtual-machine-is-violating-cis-alert-definition" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repeat above clone and modification action for the Virtual Machine is violating CIS alert definition. For the PolarClouds Virtual Machine is violating CIS alert definition, I shall remove the following symptoms:</p><ul><li>CD-ROM connected (5.5 Hardening Guide) <sup>1</sup><li>VGA only mode is not enabled (5.5 Hardening Guide) <sup>2</sup><li>USB controller connected (5.5 Hardening Guide) <sup>1</sup></ul><p><sup>1</sup> <em>vSphere 7 CIS benchmark v1.1.0, section 8.3.1 discusses “disabling unnecessary system components”. CD-ROM drives and USB adapters are necessary. Some methods of VMtools updates are not possible without a CD-ROM.</em><br /> <sup>2</sup> <em>According to latest vSphere 7 CIS benchmark (v1.1.0) this test has been removed</em><br /></p><p>Click <strong>Next &gt; Next</strong>, ensure no policies are selected to be enabled (again we will do this later) and finally <strong>Create</strong> to create the new PolarClouds Virtual Machine is violating CIS policy.</p><h4 id="vsphere-distributed-port-group-is-violating-cis-alert-definition"><span class="mr-2">vSphere Distributed Port Group is Violating CIS Alert Definition</span><a href="#vsphere-distributed-port-group-is-violating-cis-alert-definition" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repeat above clone and modification action for the vSphere Distributed Port Group is violating CIS alert definition. For the PolarClouds vSphere Distributed Port Group is violating CIS, you also need to set the Base Object Type to <strong>vCenter Adapter &gt; vSphere Distributed Port Group</strong> and Alert Type and Subtype to <strong>Network: Compliance</strong>:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-19.png" alt="PolarClouds vSphere Distributed Port Group is violating CIS" data-proofer-ignore></p><p>Out of the box at the time of writing, the VMware CIS template has no symptoms set for this alert. Therefore for this alert rather than removing symptoms we will be adding them. This is simple to do.</p><p>Select <strong>Symptoms</strong> in the right hand pane of the <strong>Symptoms / Conditions</strong> dialogue and use the filter to find the symptoms to add:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-20.png" alt="Find Symptoms" data-proofer-ignore></p><p>Once a symptom is found, use drag and drop to add the symptom to the alert.</p><p>For the PolarClouds vSphere Distributed Port Group is violating CIS alert I shall add the following and the set is met when <strong>Any</strong> of the symptoms / conditions are true:</p><ul><li>vNetwork.reject-forged-transmit-dvportgroup - The Forged Transmits policy is not set to reject <sup>1</sup><li>vNetwork.reject-mac-changes-dvportgroup - The MAC Address Changes policy is not set to reject <sup>2</sup><li>vNetwork.reject-promiscuous-mode-dvportgroup - The Promiscuous Mode policy is not set to reject <sup>3</sup><li>vNetwork.restrict-port-level-overrides - Port-level configuration VLAN overrides on VDS is not restricted <sup>4</sup></ul><p><sup>1</sup> <em>vSphere 7 CIS benchmark v1.1.0, section 7.1</em><br /> <sup>2</sup> <em>vSphere 7 CIS benchmark v1.1.0, section 7.2</em><br /> <sup>3</sup> <em>vSphere 7 CIS benchmark v1.1.0, section 7.3</em><br /> <sup>4</sup> <em>vSphere 7 CIS benchmark v1.1.0, section 7.8</em><br /></p><p>My PolarClouds vSphere Distributed Port Group is violating CIS alert Symptoms now resembles the following:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-21.png" alt="PolarClouds vSphere Distributed Port Group is violating CIS alert Symptoms" data-proofer-ignore></p><p>Click <strong>Next &gt; Next</strong>, ensure no policies are selected to be enabled (again we will do this later) and finally <strong>Create</strong> to create the new PolarClouds vSphere Distributed Port Group is violating CIS policy.</p><h4 id="vsphere-distributed-virtual-switch-is-violating-cis-alert-definition"><span class="mr-2">vSphere Distributed Virtual Switch is Violating CIS Alert Definition</span><a href="#vsphere-distributed-virtual-switch-is-violating-cis-alert-definition" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repeat above clone and modification action for the vSphere Distributed Virtual Switch is violating CIS alert definition. For the PolarClouds vSphere Distributed Virtual Switch is violating CIS alert definition, I will go with the defaults, no symptom modifications required:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-22.png" alt="PolarClouds vSphere Distributed Virtual Switch is violating CIS alert Symptoms" data-proofer-ignore></p><p>Click <strong>Next &gt; Next</strong>, ensure no policies are selected to be enabled (again we will do this later) and finally <strong>Create</strong> to create the new PolarClouds vSphere Distributed Virtual Switch is violating CIS.</p><h4 id="alert-definition-wrap-up"><span class="mr-2">Alert Definition Wrap Up</span><a href="#alert-definition-wrap-up" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Just to double check then, all in all we have four custom CIS policies:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-23.png" alt="PolarClouds Policies" data-proofer-ignore></p><p>To be 100% above board, submit details of the tests removed along with reasons for removal to your compliance and/or security department(s) for safe keeping. These will need logging as exceptions to the selected system hardening benchmark, in our case CIS.</p><h3 id="activating-alert-policies"><span class="mr-2">Activating Alert Policies</span><a href="#activating-alert-policies" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>So let’s active our custom CIS policies. From the vRO console, select <strong>Configure &gt; Policies &gt; Add</strong>. I shall name my policy <strong>PolarClouds CIS Compliance Policy</strong> and I shall inherit from <strong>Base Settings</strong>:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-24.png" alt="PolarClouds CIS Compliance Policy" data-proofer-ignore></p><p>After clicking <strong>Create Policy</strong>, lets add our custom alert definitions. Click <strong>Alerts and Symptoms</strong> and lets filter on “CIS” to see both the default and our custom PolarClouds CIS alert definitions:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-25.png" alt="Alerts and Symptoms" data-proofer-ignore></p><p>Using the drop downs, enable the PolarClouds policies:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-26.png" alt="Enable Definition" data-proofer-ignore></p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-27.png" alt="PolarClouds Enabled Definitions" data-proofer-ignore></p><p>Finally click <strong>Save</strong>.</p><h3 id="custom-groups"><span class="mr-2">Custom Groups</span><a href="#custom-groups" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>So that we can leverage our vSphere tags for compliance scanning, we need to create some custom groups in vRO.</p><p>From the vRO console, select <strong>Environment &gt; Custom Groups &gt; Add</strong>. I shall name my custom group <strong>PolarClouds CIS Compliance Group</strong>.</p><p>The group type will be <strong>Environment</strong> and the policy will be our previously created <strong>PolarClouds CIS Compliance Policy</strong>. I shall tick <strong>Keep group membership up to date</strong>.</p><p>For membership criteria, I shall select object type <strong>vCenter Adapter &gt; Virtual Machine</strong>, <strong>Properties</strong>, <strong>Summary &gt; vSphere Tag</strong>, <strong>does not contain</strong> and <strong>[&lt; Compliance-CIS-Excluded &gt;]</strong>:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-28.png" alt="Group VM Criteria" data-proofer-ignore></p><p>Add another criteria set and repeat for vCenter Adapter &gt; Host System, vSphere Distributed Port Group and vSphere Distributed Switch (you may need to copy and paste in [&lt; Compliance-CIS-Excluded &gt;] ):</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-29.png" alt="Group Criteria" data-proofer-ignore></p><p>Let’s preview our group membership:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-30.png" alt="Group Preview" data-proofer-ignore></p><p>We have a distributed switch, some port groups, a VM and an ESXi host in our group.</p><p>Notice that the vCLS and Win-2022 VMs are not listed in our custom group as these both have the CIS-Excluded vSphere tag applied to them. Nice!</p><p>Close the preview and OK the group.</p><h3 id="custom-compliance-benchmark"><span class="mr-2">Custom Compliance Benchmark</span><a href="#custom-compliance-benchmark" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>From the vRO console, select <strong>Optimise &gt; Compliance &gt; Add Custom Compliance &gt; Create a new Custom Benchmark</strong>. I shall name my benchmark <strong>PolarClouds CIS Compliance</strong>:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-31.png" alt="Custom Compliance Benchmark Name" data-proofer-ignore></p><p>I shall select my four PolarClouds alert definitions:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-32.png" alt="Custom Compliance Benchmark Definitions" data-proofer-ignore></p><p>Finally I shall enable <strong>PolarClouds CIS Compliance Policy</strong>:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-33.png" alt="Custom Compliance Benchmark Policy" data-proofer-ignore></p><p>Once complete the initial assessment should begin:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-34.png" alt="Initial Assessment Running" data-proofer-ignore></p><h2 id="vrealize-operations-vsphere-cis-compliance-results"><span class="mr-2">vRealize Operations vSphere CIS Compliance Results</span><a href="#vrealize-operations-vsphere-cis-compliance-results" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>So after all that configuration, let’s see where we need to harden our vSphere environment. From the vRO console, select <strong>Optimise &gt; Compliance &gt; Custom Benchmark</strong> - in my case <strong>PolarClouds CIS Compliance</strong>:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-35.png" alt="PolarClouds Initial Compliance" data-proofer-ignore></p><p>OK, so one out of three isn’t bad! Clicking on the alerts allows us to dig into the detail:</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-36.png" alt="Host Compliance Failures" data-proofer-ignore></p><p>OK, so the ESXi host has five compliance failures.</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-37.png" alt="Port Group Compliance Failures" data-proofer-ignore></p><p>My Distributed Port PG-TEST group has promiscuous mode enabled.</p><p><img data-src="/images/vsphere-compliance-with-vro/vsphere-compliance-with-vro-38.png" alt="VM Compliance Failures" data-proofer-ignore></p><p>And finally some doughnut has added a serial port to a VM. :doughnut: :grin:</p><h2 id="conclusion-and-wrap-up"><span class="mr-2">Conclusion and Wrap Up</span><a href="#conclusion-and-wrap-up" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Much as I try not to, we are going to have to call a temporary stop to proceedings here.</p><p>In this post we looked at regulatory compliance standards and benchmarks, vSphere tag creation and application and finally (for the majority of the post) at configuring vRealize Operations to continually monitor for system hardening benchmark compliance.</p><p>Next time we will look at creating a dashboards and reports to publicise our example PolarClouds lab environment CIS compliance and and non-compliances further.</p><p>Sure compliance is a dry and often a difficult subject to crack, however hopefully with the use of a automated and continuous monitoring tool such as vRealize Operations, we can ensure that our vSphere environment is always meeting its required compliance standard, whatever standard that may be.</p><p>This post is part 1 of a multipart series. Find the other parts here:</p><ul><li>Part 1: This part: Creating Continual Regulatory Compliance<li>Part 2: <a href="/posts/vsphere-compliance-with-vro-pt2/" target="_blank">Monitoring and Reporting Regulatory Compliance</a>)</ul><p>-Chris</p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/pro-tip/" class="post-tag no-text-decoration" >Pro-Tip</a> <a href="/tags/vmware/" class="post-tag no-text-decoration" >VMware</a> <a href="/tags/deployment/" class="post-tag no-text-decoration" >Deployment</a> <a href="/tags/esxi/" class="post-tag no-text-decoration" >ESXi</a> <a href="/tags/vrealize/" class="post-tag no-text-decoration" >vRealize</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=vSphere+Compliance+with+vRealize+Operations+and+Tagging+-+PolarClouds&url=%2Fposts%2Fvsphere-compliance-with-vro%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=vSphere+Compliance+with+vRealize+Operations+and+Tagging+-+PolarClouds&u=%2Fposts%2Fvsphere-compliance-with-vro%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fvsphere-compliance-with-vro%2F&text=vSphere+Compliance+with+vRealize+Operations+and+Tagging+-+PolarClouds" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fposts%2Fvsphere-compliance-with-vro%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://reddit.com/submit?url=%2Fposts%2Fvsphere-compliance-with-vro%2F&title=vSphere+Compliance+with+vRealize+Operations+and+Tagging+-+PolarClouds" data-toggle="tooltip" data-placement="top" title="Reddit" target="_blank" rel="noopener" aria-label="Reddit"> <i class="fa-fw fab fa-reddit"></i> </a> <a href="http://service.weibo.com/share/share.php?title=vSphere+Compliance+with+vRealize+Operations+and+Tagging+-+PolarClouds&url=%2Fposts%2Fvsphere-compliance-with-vro%2F" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/vsphere-compliance-with-vro-pt2/">vSphere Compliance with vRealize Operations and Tagging - Part 2</a><li><a href="/posts/powershell-credential-handling/">PowerShell Credential Handling</a><li><a href="/posts/esxi-rpi-ups-pt1/">UPS Triggered Shut Down of ESXi from Raspberry Pi - Part 1</a><li><a href="/posts/esxi-rpi-ups-pt2/">UPS Triggered Shut Down of ESXi from Raspberry Pi - Part 2</a><li><a href="/posts/esxi-rpi-ups-pt3/">UPS Triggered Shut Down of ESXi from Raspberry Pi - Part 3</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pro-tip/">Pro-Tip</a> <a class="post-tag" href="/tags/deployment/">Deployment</a> <a class="post-tag" href="/tags/esxi/">ESXi</a> <a class="post-tag" href="/tags/vmware/">VMware</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/vrealize/">vRealize</a> <a class="post-tag" href="/tags/powershell/">PowerShell</a> <a class="post-tag" href="/tags/rubrik/">Rubrik</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/vsphere-compliance-with-vro-pt2/"><div class="card-body"> <em class="small" data-ts="1656979200" data-df="ll" > Jul 5, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>vSphere Compliance with vRealize Operations and Tagging - Part 2</h3><div class="text-muted small"><p> Last time we looked at regulatory compliance standards and benchmarks, vSphere tag creation and application and finally for the majority of the post at configuring vRealize Operations to continual...</p></div></div></a></div><div class="card"> <a href="/posts/esxi-rpi-ups-pt1/"><div class="card-body"> <em class="small" data-ts="1618963200" data-df="ll" > Apr 21, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>UPS Triggered Shut Down of ESXi from Raspberry Pi - Part 1</h3><div class="text-muted small"><p> By the shear luck of being in the right place at the right time, I managed to get my hands on an APC Smart-UPS C1500 Uninterruptable Power Supply (UPS) for my home lab use. A UPS is a piece of ha...</p></div></div></a></div><div class="card"> <a href="/posts/esxi-rpi-ups-pt2/"><div class="card-body"> <em class="small" data-ts="1620086400" data-df="ll" > May 4, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>UPS Triggered Shut Down of ESXi from Raspberry Pi - Part 2</h3><div class="text-muted small"><p> Last time we looked at what needs to happen should we loose the input mains electricity supply to our newly acquired Uninterruptable Power Supply (UPS). For example during a power cut. We also go...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/rubrik-technical-professional/" class="btn btn-outline-primary" prompt="Older"><p>Rubrik Technical Professional</p></a> <a href="/posts/vsphere-compliance-with-vro-pt2/" class="btn btn-outline-primary" prompt="Newer"><p>vSphere Compliance with vRealize Operations and Tagging - Part 2</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/chall32">Chris Hall</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pro-tip/">Pro-Tip</a> <a class="post-tag" href="/tags/deployment/">Deployment</a> <a class="post-tag" href="/tags/esxi/">ESXi</a> <a class="post-tag" href="/tags/vmware/">VMware</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/vrealize/">vRealize</a> <a class="post-tag" href="/tags/powershell/">PowerShell</a> <a class="post-tag" href="/tags/rubrik/">Rubrik</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en-gb.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
